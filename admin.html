<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BOHO Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- External BOHO Styles -->
  <link rel="stylesheet" href="./admin.css">

  <script>
    // Login Protection
    const ADMIN_TOKEN = localStorage.getItem("ADMIN_TOKEN");
    if (!ADMIN_TOKEN) {
      window.location.href = "./login.html";
    }
  </script>
</head>

<body>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="brand">
      <div class="logo-circle">B</div>
      <span>BOHO Admin</span>
    </div>

    <button class="tab-button active" onclick="showTab('dashboard')">
      Dashboard
    </button>

    <button class="tab-button" onclick="showTab('risk')">
      Risk Config
    </button>

    <button class="tab-button" onclick="showTab('logs')">
      Logs
    </button>

  </div>

  <!-- MAIN CONTENT -->
  <div class="content">

    <!-- DASHBOARD TAB -->
    <div id="dashboard" class="tab active">
      <h1>Dashboard</h1>

      <div class="card">
        <h3>System State</h3>
        <pre id="state_output"></pre>
        <button onclick="refreshState()" class="btn-orange">Refresh</button>
      </div>

      <div class="card">
        <h3>Positions</h3>
        <pre id="positions_output"></pre>
        <button onclick="refreshPositions()" class="btn-orange">Refresh</button>
      </div>

      <div class="card">
        <h3>Actions</h3>
        <button onclick="kill()" class="btn-red">Kill System</button>
        <button onclick="cancelAll()" class="btn-yellow">Cancel All</button>
      </div>

    </div>

    <!-- RISK CONFIG TAB -->
    <div id="risk" class="tab">
      <h1>Risk Configuration</h1>

      <div class="card">
        <label>Max Daily Loss</label>
        <input id="maxLoss" type="number">
        <label>Max Daily Profit</label>
        <input id="maxProfit" type="number">
        <label>Trailing Step</label>
        <input id="trailStep" type="number">

        <button onclick="saveConfig()" class="btn-orange">Save</button>
      </div>
    </div>

    <!-- LOGS TAB -->
    <div id="logs" class="tab">
      <h1>Live Logs</h1>
      <pre id="logs_output"></pre>
      <button onclick="refreshLogs()" class="btn-orange">Refresh</button>
    </div>

  </div>

  <!-- ORIGINAL SCRIPT (UNTOUCHED) -->
  <script>
    async function refreshState() {
      const res = await fetch("/api/state", {
        headers: { Authorization: "Bearer " + ADMIN_TOKEN }
      });
      document.getElementById("state_output").textContent = await res.text();
    }

    async function refreshPositions() {
      const res = await fetch("/api/positions", {
        headers: { Authorization: "Bearer " + ADMIN_TOKEN }
      });
      document.getElementById("positions_output").textContent = await res.text();
    }

    async function refreshLogs() {
      const res = await fetch("/api/logs", {
        headers: { Authorization: "Bearer " + ADMIN_TOKEN }
      });
      document.getElementById("logs_output").textContent = await res.text();
    }

    async function kill() {
      await fetch("/api/admin/kill", {
        method: "POST",
        headers: { Authorization: "Bearer " + ADMIN_TOKEN }
      });
      refreshState();
    }

    async function cancelAll() {
      await fetch("/api/admin/cancel", {
        method: "POST",
        headers: { Authorization: "Bearer " + ADMIN_TOKEN }
      });
    }

    async function saveConfig() {
      const body = {
        maxLoss: document.getElementById("maxLoss").value,
        maxProfit: document.getElementById("maxProfit").value,
        trailStep: document.getElementById("trailStep").value
      };

      await fetch("/api/admin/set-config", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + ADMIN_TOKEN
        },
        body: JSON.stringify(body)
      });
    }

    function showTab(id) {
      document.querySelectorAll(".tab").forEach(x => x.classList.remove("active"));
      document.querySelectorAll(".tab-button").forEach(x => x.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      event.target.classList.add("active");
    }
  </script>

</body>
</html>
